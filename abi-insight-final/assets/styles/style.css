// LIGHTBOX FUNCTIONALITY (COMMIT 35)

// 1. Get references to necessary DOM elements
const lightbox = document.getElementById('mediaLightbox');
const closeButton = lightbox.querySelector('.lightbox-close-btn');
const mediaContainer = lightbox.querySelector('.lightbox-media-container');
// We use the entire body/document to listen for clicks since the items are in separate grids
const galleryElements = document.querySelectorAll('.js-gallery-item');


// Function to reset the lightbox content and close it
function closeLightbox() {
    lightbox.style.display = 'none';
    // Clear the media container content
    mediaContainer.innerHTML = ''; 
}

// Function to handle opening and loading media
function openLightbox(mediaUrl, mediaType) {
    // Clear previous content
    mediaContainer.innerHTML = '';

    let mediaElement;

    if (mediaType === 'image') {
        mediaElement = document.createElement('img');
        mediaElement.src = mediaUrl;
        mediaElement.className = 'lightbox-media-content';
        mediaElement.style.maxWidth = '100%'; // Ensures large images fit the modal
        mediaElement.style.maxHeight = '80vh';
    } else if (mediaType === 'video') {
        // Creates a responsive iframe wrapper for YouTube/Vimeo embeds
        const videoWrapper = document.createElement('div');
        videoWrapper.className = 'video-responsive'; 
        videoWrapper.style.maxWidth = '900px'; // Limit max video size inside modal
        videoWrapper.style.margin = '0 auto';
        
        mediaElement = document.createElement('iframe');
        mediaElement.src = mediaUrl + '?autoplay=1'; // Add autoplay parameter
        mediaElement.title = "Media Content";
        mediaElement.frameBorder = '0';
        mediaElement.allow = 'autoplay; fullscreen; picture-in-picture';
        mediaElement.allowFullscreen = true;
        
        videoWrapper.appendChild(mediaElement);
        mediaElement = videoWrapper; // The actual element inserted is the responsive wrapper
    }

    if (mediaElement) {
        mediaContainer.appendChild(mediaElement);
    }
    
    // Display the lightbox
    lightbox.style.display = 'flex';
}

// 2. Add Event Listeners

// Close on button click
closeButton.addEventListener('click', closeLightbox);

// Close on clicking outside the content (on the overlay)
lightbox.addEventListener('click', (event) => {
    // Only close if the click target is the overlay itself, not content inside
    if (event.target === lightbox) {
        closeLightbox();
    }
});

// Close on ESC key press
document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape' && lightbox.style.display === 'flex') {
        closeLightbox();
    }
});


// Add listeners to all gallery items
galleryElements.forEach(item => {
    item.addEventListener('click', (event) => {
        // Find the closest parent that is the clickable item (in this case, the item itself)